<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administración - Ibagué Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-8">
        <h1 class="text-2xl font-bold mb-6">Panel de Administración</h1>
        <input type="text" id="filterInput" placeholder="Filtrar por nombre..." class="mb-4 px-2 py-1 border rounded">
        <button id="exportBtn" class="mb-4 ml-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Exportar a CSV</button>
        <table class="min-w-full bg-white border">
            <thead>
                <tr>
                    <th class="py-2 px-4 border">Nombre</th>
                    <th class="py-2 px-4 border">Edad</th>
                    <th class="py-2 px-4 border">Género</th>
                    <th class="py-2 px-4 border">Horas Internet</th>
                    <th class="py-2 px-4 border">Dispositivo</th>
                    <th class="py-2 px-4 border">Red Social</th>
                    <th class="py-2 px-4 border">Noticias</th>
                    <th class="py-2 px-4 border">Formato</th>
                    <th class="py-2 px-4 border">Acciones</th>
                </tr>
            </thead>
            <tbody id="usersTable"></tbody>
        </table>
    </div>
    <script>
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        const tbody = document.getElementById('usersTable');
        const filterInput = document.getElementById('filterInput');
        const exportBtn = document.getElementById('exportBtn');

        function renderTable(data) {
            tbody.innerHTML = '';
            data.forEach((user, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="border px-4 py-2">${user.name}</td>
                    <td class="border px-4 py-2">${user.age}</td>
                    <td class="border px-4 py-2">${user.gender}</td>
                    <td class="border px-4 py-2">${user.q1}</td>
                    <td class="border px-4 py-2">${user.q2}</td>
                    <td class="border px-4 py-2">${user.q3}</td>
                    <td class="border px-4 py-2">${user.q4}</td>
                    <td class="border px-4 py-2">${user.q5}</td>
                    <td class="border px-4 py-2">
                        <button class="bg-red-500 text-white px-2 py-1 rounded delete-btn" data-idx="${idx}">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Eliminar registro
        tbody.addEventListener('click', function(e) {
            if (e.target.classList.contains('delete-btn')) {
                const idx = e.target.getAttribute('data-idx');
                users.splice(idx, 1);
                localStorage.setItem('users', JSON.stringify(users));
                renderTable(users);
            }
        });

        // Filtrar por nombre
        filterInput.addEventListener('input', function() {
            const value = this.value.toLowerCase();
            const filtered = users.filter(u => u.name.toLowerCase().includes(value));
            renderTable(filtered);
        });

        // Exportar a CSV
        exportBtn.addEventListener('click', function() {
            let csv = 'Nombre,Edad,Género,Horas Internet,Dispositivo,Red Social,Noticias,Formato\n';
            users.forEach(u => {
                csv += `"${u.name}","${u.age}","${u.gender}","${u.q1}","${u.q2}","${u.q3}","${u.q4}","${u.q5}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'usuarios_ibague_digital.csv';
            a.click();
            URL.revokeObjectURL(url);
        });

        // Inicializar tabla
        renderTable(users);
    </script>
</body>
</html>